# æ„å»ºå’Œç¼–è¯‘è¯¦è§£

## 1. `npm run dev` vs `npm run build` çš„åŒºåˆ«

### `npm run dev`ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
```bash
npm run dev
```

**ç‰¹ç‚¹ï¼š**
- âœ… å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆVite Dev Serverï¼‰
- âœ… å®æ—¶ç¼–è¯‘ï¼ˆä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡æ–°ç¼–è¯‘ï¼‰
- âœ… ç”Ÿæˆçš„æ–‡ä»¶**æœªä¼˜åŒ–**ï¼ˆä¾¿äºè°ƒè¯•ï¼‰
- âœ… åŒ…å« Source Mapsï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
- âœ… åŒ…å« HMRï¼ˆHot Module Replacementï¼‰ä»£ç 
- âœ… æ–‡ä»¶è¾ƒå¤§ï¼ˆåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼‰
- âœ… æ–‡ä»¶åå¸¦ hashï¼ˆå¦‚ `index.tsx-loader.js`ï¼‰

**è¾“å‡ºç¤ºä¾‹ï¼š**
```javascript
// dist/src/content/index.tsx.js
// åŒ…å«å¤§é‡å¼€å‘å·¥å…·ä»£ç 
import { createHotContext } from "/vendor/vite-client.js"
import.meta.hot = createHotContext(...)
// ... å®é™…ä»£ç  ...
```

---

### `npm run build`ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
```bash
npm run build
```

**ç‰¹ç‚¹ï¼š**
- âŒ **ä¸å¯åŠ¨æœåŠ¡å™¨**ï¼ˆä¸€æ¬¡æ€§æ„å»ºï¼‰
- âœ… ä»£ç **å®Œå…¨ä¼˜åŒ–**ï¼ˆå‹ç¼©ã€æ··æ·†ã€tree-shakingï¼‰
- âœ… ç§»é™¤æ‰€æœ‰è°ƒè¯•ä»£ç 
- âœ… ç§»é™¤ Source Mapsï¼ˆå¯é€‰ï¼‰
- âœ… æ–‡ä»¶**æ›´å°**ï¼ˆå‡å°‘ 50-80%ï¼‰
- âœ… æ–‡ä»¶åå¯èƒ½å¸¦ hashï¼ˆç”¨äºç¼“å­˜ï¼‰

**è¾“å‡ºç¤ºä¾‹ï¼š**
```javascript
// dist/src/content/index.tsx.js
// å‹ç¼©åçš„ä»£ç ï¼Œæ²¡æœ‰å¼€å‘å·¥å…·
(function(){var e=...})()
```

---

### ä¸ºä»€ä¹ˆæ‰“åŒ…æ—¶ç”¨ `build`ï¼Ÿ

| åœºæ™¯ | ä½¿ç”¨å‘½ä»¤ | åŸå›  |
|------|---------|------|
| **å¼€å‘è°ƒè¯•** | `npm run dev` | éœ€è¦å®æ—¶ç¼–è¯‘ã€çƒ­æ›´æ–° |
| **æµ‹è¯•åŠŸèƒ½** | `npm run dev` | å¿«é€Ÿè¿­ä»£ |
| **å‘å¸ƒåˆ° Chrome Web Store** | `npm run build` | æ–‡ä»¶å°ã€åŠ è½½å¿« |
| **åˆ†å‘ç»™ç”¨æˆ·** | `npm run build` | ä¼˜åŒ–åçš„ä»£ç  |
| **CI/CD è‡ªåŠ¨åŒ–** | `npm run build` | ä¸éœ€è¦æœåŠ¡å™¨ |

**æ€»ç»“ï¼š**
- å¼€å‘æ—¶ç”¨ `dev`ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
- å‘å¸ƒæ—¶ç”¨ `build`ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰

---

## 2. ä¸ºä»€ä¹ˆç¼–è¯‘åçš„æ–‡ä»¶ç»“æ„ä¸åŒï¼Ÿ

### æºç ç»“æ„ï¼ˆsrc/ï¼‰
```
src/
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ index.tsx      # TypeScript + React
â”‚   â””â”€â”€ index.css      # CSS æ–‡ä»¶
â””â”€â”€ popup/
    â”œâ”€â”€ index.html     # HTML
    â”œâ”€â”€ index.tsx      # TypeScript + React
    â””â”€â”€ index.css      # CSS æ–‡ä»¶
```

### ç¼–è¯‘åç»“æ„ï¼ˆdist/src/ï¼‰- å¼€å‘æ¨¡å¼

```
dist/src/
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ index.tsx.js           # âœ… ç¼–è¯‘åçš„ JSï¼ˆç‹¬ç«‹æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ index.tsx-loader.js    # Vite åŠ è½½å™¨ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
â”‚   â””â”€â”€ index.css.js           # âœ… CSS è½¬ JSï¼ˆç‹¬ç«‹æ–‡ä»¶ï¼‰
â””â”€â”€ popup/
    â””â”€â”€ index.html              # âš ï¸ HTMLï¼ˆè¢« Vite æ›¿æ¢ä¸ºå¼€å‘æ¨¡å¼å ä½é¡µï¼‰
```

### ä¸ºä»€ä¹ˆ popup çš„ CSS/TSX ä¸åœ¨ dist ä¸­ï¼Ÿ

**åŸå› ï¼šå¼€å‘æ¨¡å¼ä¸‹çš„ç‰¹æ®Šå¤„ç†**

#### Content Script vs Popup çš„åŒºåˆ«

1. **Content Script** (`src/content/index.tsx`)
   - âœ… **ç¼–è¯‘æˆç‹¬ç«‹æ–‡ä»¶**ï¼š`dist/src/content/index.tsx.js`
   - åŸå› ï¼šéœ€è¦æ³¨å…¥åˆ°ç½‘é¡µä¸­ï¼Œä¸èƒ½ä¾èµ–å¼€å‘æœåŠ¡å™¨
   - CSS ä¹Ÿç¼–è¯‘æˆç‹¬ç«‹æ–‡ä»¶ï¼š`dist/src/content/index.css.js`

2. **Popup** (`src/popup/index.tsx`)
   - âŒ **ä¸ç¼–è¯‘æˆç‹¬ç«‹æ–‡ä»¶**ï¼ˆå¼€å‘æ¨¡å¼ä¸‹ï¼‰
   - åŸå› ï¼šPopup åªåœ¨æ‰©å±•å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ Vite Dev Server åŠ¨æ€åŠ è½½
   - HTML è¢«æ›¿æ¢ä¸ºå¼€å‘æ¨¡å¼å ä½é¡µï¼Œå®é™…ä»£ç é€šè¿‡ `http://localhost:5173` åŠ è½½

#### å¼€å‘æ¨¡å¼ vs ç”Ÿäº§æ¨¡å¼

- **å¼€å‘æ¨¡å¼** (`npm run dev`)ï¼š
  - Popup TSX/CSS â†’ é€šè¿‡ Vite Dev Server åŠ¨æ€åŠ è½½
  - ä¼˜ç‚¹ï¼šçƒ­æ›´æ–°ã€å¿«é€Ÿå¼€å‘
  - ç¼ºç‚¹ï¼šéœ€è¦å¼€å‘æœåŠ¡å™¨è¿è¡Œ

- **ç”Ÿäº§æ¨¡å¼** (`npm run build`)ï¼š
  - Popup TSX/CSS â†’ æ‰“åŒ…åˆ° `dist/assets/` ç›®å½•
  - HTML æ­£ç¡®å¼•ç”¨æ‰“åŒ…åçš„æ–‡ä»¶
  - ä¼˜ç‚¹ï¼šç‹¬ç«‹è¿è¡Œï¼Œä¸éœ€è¦æœåŠ¡å™¨

---

## 3. src â†’ dist æ˜ å°„å…³ç³»

### å®Œæ•´æ˜ å°„è¡¨

**æ³¨æ„ï¼šå¼€å‘æ¨¡å¼å’Œç”Ÿäº§æ¨¡å¼çš„å¤„ç†æ–¹å¼ä¸åŒï¼**

#### å¼€å‘æ¨¡å¼ (`npm run dev`)

| æºç è·¯å¾„ | ç¼–è¯‘åè·¯å¾„ | è¯´æ˜ |
|---------|-----------|------|
| `src/manifest.json` | `dist/manifest.json` | ç›´æ¥å¤åˆ¶ï¼ˆä½†è·¯å¾„è¢«ä¿®æ”¹ï¼‰ |
| `src/content/index.tsx` | `dist/src/content/index.tsx.js` | âœ… TSX â†’ JSï¼ˆç‹¬ç«‹æ–‡ä»¶ï¼‰ |
| `src/content/index.css` | `dist/src/content/index.css.js` | âœ… CSS â†’ JS æ¨¡å—ï¼ˆç‹¬ç«‹æ–‡ä»¶ï¼‰ |
| `src/popup/index.html` | `dist/src/popup/index.html` | âš ï¸ HTMLï¼ˆè¢« Vite æ›¿æ¢ä¸ºå¼€å‘æ¨¡å¼å ä½é¡µï¼‰ |
| `src/popup/index.tsx` | âŒ **ä¸åœ¨ dist ä¸­** | ğŸ”„ é€šè¿‡ Vite Dev Server åŠ¨æ€åŠ è½½ |
| `src/popup/index.css` | âŒ **ä¸åœ¨ dist ä¸­** | ğŸ”„ é€šè¿‡ Vite Dev Server åŠ¨æ€åŠ è½½ |

**å…³é”®åŒºåˆ«ï¼š**
- **Content Script**ï¼šç¼–è¯‘æˆç‹¬ç«‹æ–‡ä»¶ï¼ˆå› ä¸ºéœ€è¦æ³¨å…¥åˆ°ç½‘é¡µï¼‰
- **Popup**ï¼šåœ¨å¼€å‘æ¨¡å¼ä¸‹é€šè¿‡ Vite Dev Server åŠ¨æ€åŠ è½½ï¼ˆä¸ç”Ÿæˆé™æ€æ–‡ä»¶ï¼‰

#### ç”Ÿäº§æ¨¡å¼ (`npm run build`)

åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œpopup çš„ TSX å’Œ CSS ä¼šè¢«æ‰“åŒ…åˆ° `dist/assets/` ç›®å½•ï¼ŒHTML ä¼šæ­£ç¡®å¼•ç”¨å®ƒä»¬ã€‚

### å…³é”®ç‚¹

1. **ç›®å½•ç»“æ„ä¿æŒ**ï¼š`src/` â†’ `dist/src/`
   - ä¿æŒç›¸å¯¹è·¯å¾„ä¸€è‡´
   - manifest.json ä¸­çš„è·¯å¾„æ‰èƒ½æ­£ç¡®å·¥ä½œ

2. **æ–‡ä»¶æ‰©å±•åå˜åŒ–**ï¼š
   - `.tsx` â†’ `.js`
   - `.css` â†’ `.css.js`ï¼ˆæ¨¡å—åŒ–ï¼‰

3. **æ–°å¢æ–‡ä»¶**ï¼š
   - `*-loader.js`ï¼šVite å¼€å‘æ¨¡å¼çš„åŠ è½½å™¨
   - `vendor/`ï¼šç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆReactã€Vite ç­‰ï¼‰

---

## 4. ä¸ºä»€ä¹ˆ CSS å˜æˆ CSS.jsï¼Ÿ

### ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸æ¨èï¼‰
```html
<!-- ä¼ ç»Ÿæ–¹å¼ -->
<link rel="stylesheet" href="style.css">
```
- CSS æ˜¯ç‹¬ç«‹çš„æ–‡ä»¶
- æµè§ˆå™¨éœ€è¦å•ç‹¬è¯·æ±‚
- æ— æ³•æ¨¡å—åŒ–

### ç°ä»£æ–¹å¼ï¼ˆVite ä½¿ç”¨ï¼‰
```javascript
// åœ¨ TSX ä¸­å¯¼å…¥
import './index.css'

// Vite ç¼–è¯‘åå˜æˆï¼š
// index.css.js
const css = "...CSS å†…å®¹..."
// åŠ¨æ€æ³¨å…¥åˆ°é¡µé¢
```

### ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ

1. **æ¨¡å—åŒ–**
   - CSS å’Œ JS ä¸€èµ·æ‰“åŒ…
   - æŒ‰éœ€åŠ è½½ï¼ˆåªåŠ è½½ç”¨åˆ°çš„æ ·å¼ï¼‰

2. **ä½œç”¨åŸŸéš”ç¦»**
   - é¿å…æ ·å¼å†²çª
   - CSS Modules æ”¯æŒ

3. **å¼€å‘ä½“éªŒ**
   - HMRï¼ˆçƒ­æ›´æ–°ï¼‰
   - ä¿®æ”¹ CSS ç«‹å³ç”Ÿæ•ˆ

4. **æ€§èƒ½ä¼˜åŒ–**
   - å‡å°‘ HTTP è¯·æ±‚
   - ä»£ç åˆ†å‰²æ›´çµæ´»

### CSS.js è¿˜æ˜¯ CSS æ–‡ä»¶å—ï¼Ÿ

**æŠ€æœ¯ä¸Šï¼š** æ˜¯ JavaScript æ–‡ä»¶ï¼Œä½†å†…å®¹æ˜¯ CSS

**è¿è¡Œæ—¶ï¼š** æµè§ˆå™¨æ‰§è¡Œ JSï¼ŒåŠ¨æ€åˆ›å»º `<style>` æ ‡ç­¾æ³¨å…¥ CSS

**æ•ˆæœï¼š** å’Œä¼ ç»Ÿ CSS æ–‡ä»¶ä¸€æ ·ï¼Œä½†æ›´çµæ´»

---

## 5. å…³äº TSXï¼ˆä½ çš„é—®é¢˜æ²¡å†™å®Œï¼‰

å¦‚æœä½ æƒ³é—®å…³äº TSX çš„é—®é¢˜ï¼Œå¸¸è§çš„æœ‰ï¼š

### TSX æ˜¯ä»€ä¹ˆï¼Ÿ
- **TSX = TypeScript + JSX**
- JSXï¼šJavaScript çš„è¯­æ³•æ‰©å±•ï¼ˆå†™ HTML çš„è¯­æ³•ï¼‰
- TypeScriptï¼šå¸¦ç±»å‹çš„ JavaScript

### ä¸ºä»€ä¹ˆç”¨ TSXï¼Ÿ
```tsx
// TSX å†™æ³•ï¼ˆåƒ HTMLï¼‰
function Component() {
  return <div>Hello</div>
}

// ç¼–è¯‘åå˜æˆæ™®é€š JS
function Component() {
  return React.createElement('div', null, 'Hello')
}
```

### TSX â†’ JS ç¼–è¯‘è¿‡ç¨‹
```
index.tsx (æºç )
    â†“
TypeScript ç¼–è¯‘å™¨
    â†“
JSX è½¬æ¢å™¨
    â†“
index.tsx.js (ç¼–è¯‘å)
```

---

## æ€»ç»“

| é—®é¢˜ | ç­”æ¡ˆ |
|------|------|
| dev vs build | dev æœ‰æœåŠ¡å™¨+æœªä¼˜åŒ–ï¼Œbuild æ— æœåŠ¡å™¨+ä¼˜åŒ– |
| æ–‡ä»¶ç»“æ„ä¸åŒ | Vite æ¨¡å—åŒ–å¤„ç†ï¼ŒCSS/TSX æ‰“åŒ…åˆ° JS |
| src â†’ dist æ˜ å°„ | ä¿æŒç›®å½•ç»“æ„ï¼Œæ‰©å±•åå˜åŒ– |
| CSS å˜ CSS.js | æ¨¡å—åŒ–ã€æŒ‰éœ€åŠ è½½ã€HMR |
| ä¸ºä»€ä¹ˆæ‰“åŒ…ç”¨ build | æ–‡ä»¶å°ã€æ€§èƒ½å¥½ã€é€‚åˆå‘å¸ƒ |

